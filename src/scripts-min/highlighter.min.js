function Token(a,b,c,d){this.value=a,this.pos=b,this.size=c,this.color=d}function Highlighter(a){this.langObj=a,this.isMultilineComment=!1,this.draw=function(){for(var a=document.getElementsByClassName("blob-wrapper")[0].getElementsByTagName("table")[0],b=a.querySelectorAll("tbody td"),c=0;c<b.length;c++){var d=b[c];if(d.id.indexOf("LC")!==-1){var e=this.lexer(d.innerHTML);d.innerHTML=this.paint(e,d.innerHTML)}}},this.paint=function(a,b){if(0===a.length)return this.getSpan(b,this.langObj.default_color);for(var c="",d=0,e=0;d<b.length;)if(e<a.length&&d<a[e].pos)c+=this.getSpan(b.substring(d,a[e].pos),this.langObj.default_color),d=a[e].pos;else if(e===a.length)c+=this.getSpan(b.substring(d,b.length),this.langObj.default_color),d=b.length;else{var f=a[e].color;for(c+=this.openSpan(f),c+=a[e].value,d+=a[e].value.length,e++;e<a.length&&d===a[e].pos&&a[e].color===f;)c+=a[e].value,d+=a[e].value.length,e++;c+=this.closeSpan()}return c},this.openSpan=function(a){return'<span style="color:'+a+';">'},this.closeSpan=function(){return"</span>"},this.getSpan=function(a,b){return this.openSpan(b)+a+this.closeSpan()},this.isId=function(a,b){return a>="a"&&a<="z"||a>="A"&&a<="Z"||"_"===a||!b&&this.isNumber(a)},this.isNumber=function(a){return a>="0"&&a<="9"},this.isLiteralString=function(a){return'"'===a||"'"===a},this.startsWith=function(a,b,c){return void 0!==a&&b.substring(c,b.length).startsWith(a)},this.matchRegex=function(a,b,c,d){a.startsWith("^")||(a="^"+a),void 0===b&&(b="");var e=new RegExp(a,b);return c.substring(d,c.length).match(e)},this.getId=function(a,b,c){var d=b,e=a[b];for(b++;b<a.length&&this.isId(a[b],!1);)e+=a[b],b++;c(e,d,this.langObj)},this.getNumber=function(a,b,c){var d=a.substring(b,a.length).match(new RegExp("^[-+]?[0-9]*.?[0-9]+"))[0];c(d,b,this.langObj)},this.getLiteralString=function(a,b,c){var d=b,e=a[b];do b++,e+=a[b];while(b<a.length&&a[b]!==a[d]);c(e,d,this.langObj)},this.getMultilineComment=function(a,b,c,d){for(var e=c,f=!0,g="";c<b.length&&!b.substring(c,b.length).startsWith(a);)g+=b[c],c++;c<b.length&&(g+=a,f=!1),d(g,e,f,this)},this.lexer=function(a){for(var b=Array(),c=0;c<a.length;)if(" "!==a[c]&&"\t"!==a[c]&&"\n"!==a[c])if(this.isMultilineComment||this.startsWith(this.langObj.begin_multiline_comment,a,c))this.isMultilineComment=!0,this.getMultilineComment(this.langObj.end_multiline_comment,a,c,function(a,d,e,f){f.isMultilineComment=e;var g=f.langObj.default_color;void 0!==f.langObj.comment_color&&(g=f.langObj.comment_color),b.push(new Token(a,d,a.length,g)),c+=a.length});else if(this.startsWith(this.langObj.single_line_comment,a,c)){var d=a.substring(c,a.length),e=this.langObj.default_color;void 0!==this.langObj.comment_color&&(e=this.langObj.comment_color),b.push(new Token(d,c,d.length,e)),c+=d.length}else if(this.isId(a[c],!0))this.getId(a,c,function(a,d,e){var f=e.default_color,g=!0;e.grammar.every(function(b){return void 0!==b.keywords&&b.keywords.every(function(c){return c.keyword.valueOf()!==a.valueOf()||(f=b.color,g=!1,!1)}),g}),g&&void 0!==e.id_color&&(f=e.id_color),b.push(new Token(a,d,a.length,f)),c+=a.length});else if(this.isLiteralString(a[c]))this.getLiteralString(a,c,function(a,d,e){var f=e.default_color;void 0!==e.string_color&&(f=e.string_color),b.push(new Token(a,d,a.length,f)),c+=a.length});else if(this.isNumber(a[c]))this.getNumber(a,c,function(a,d,e){var f=e.default_color;void 0!==e.number_color&&(f=e.number_color),b.push(new Token(a,d,a.length,f)),c+=a.length});else{var f=!0,g=this;this.langObj.grammar.every(function(d){return void 0!==d.operators&&d.operators.every(function(e){return!g.startsWith(e.operator,a,c)||(b.push(new Token(e.operator,c,e.operator.length,d.color)),c+=e.operator.length,f=!1,!1)}),f&&void 0!==d.regexes&&d.regexes.every(function(e){var h=g.matchRegex(e.regex,e.modifier,a,c);return null===h||(b.push(new Token(h[0],c,h[0].length,d.color)),c+=h[0].length,f=!1,!1)}),f}),f&&c++}else c++;return b}}
